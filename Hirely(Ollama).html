<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hirely - AI Smart Resume Ranker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            overflow-x: hidden;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #a8a8a8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #888; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes smoothTextFade {
            0% { opacity: 0; transform: translateY(10px); }
            15% { opacity: 1; transform: translateY(0); }
            85% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        #tagline { animation: smoothTextFade 7s ease-in-out infinite; }
        
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        .loader {
            width: 50px; height: 50px; border-radius: 50%; display: inline-block;
            position: relative; border: 3px solid; border-color: #DDD #DDD transparent transparent;
            box-sizing: border-box; animation: rotation 1s linear infinite;
        }
        .loader::after, .loader::before {
            content: ''; box-sizing: border-box; position: absolute; left: 0; right: 0;
            top: 0; bottom: 0; margin: auto; border: 3px solid;
            border-color: transparent transparent #4f46e5 #4f46e5;
            width: 40px; height: 40px; border-radius: 50%;
            animation: rotationBack 0.5s linear infinite; transform-origin: center center;
        }
        .loader::before {
            width: 30px; height: 30px; border-color: #DDD #DDD transparent transparent;
            animation: rotation 1.5s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes rotationBack { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); display: flex; align-items: center;
            justify-content: center; z-index: 1000; opacity: 0;
            transition: opacity 0.3s ease; pointer-events: none;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: white; padding: 2rem; border-radius: 1rem; max-width: 90%;
            width: 600px; max-height: 80vh; overflow-y: auto;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        #mask-circle-animate {
            animation: circle-wipe-effect 9s ease-in-out infinite;
        }

        @keyframes circle-wipe-effect {
            0% { cx: -160; }
            27.7% { cx: 1760; } 
            27.8%, 50% { cx: 1760; }
            50.1% { cx: 1760; }
            77.8% { cx: -160; }
            77.9%, 100% { cx: -160; }
        }

        .details-content {
            max-height: 0; overflow: hidden;
            transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out;
        }
        .details-content.expanded { max-height: 1000px; margin-top: 1.5rem; }
        .expandable-card-header { cursor: pointer; }
        .chevron-icon { transition: transform 0.3s ease-in-out; }

        .dropzone.is-dragging {
            border-color: #4f46e5; box-shadow: 0 0 20px rgba(79, 70, 229, 0.3); transform: scale(1.02);
        }
        .dropzone { transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out; }
        
        .file-item {
            display: flex; align-items: center; background-color: #eef2ff; color: #3730a3;
            font-size: 0.875rem; font-weight: 500; padding: 0.5rem 0.75rem;
            border-radius: 9999px; animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes pulse-glow-button {
            0%, 100% { box-shadow: 0 0 0 0 rgba(129, 140, 248, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(129, 140, 248, 0); }
        }
        #rankButton:not(:disabled) { animation: pulse-glow-button 2s infinite; }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translate(-50%, 150%);
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.5s ease-in-out;
            z-index: 2000;
        }
        #toast.show {
            transform: translate(-50%, 0);
        }

        .chart-container, .result-card {
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        .chart-container:hover {
            transform: scale(1.02);
        }
        .result-card:hover {
             transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .interactive-btn {
            transition: all 0.2s ease-in-out;
        }
        .interactive-btn:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        .skill-pill, .strength-weakness li {
            transition: all 0.2s ease-in-out;
        }
        .skill-pill:hover {
            transform: scale(1.05);
            background-color: #c7d2fe;
        }
        .strength-weakness li:hover {
            transform: translateX(4px);
            background-color: rgba(238, 242, 255, 0.8);
        }
    </style>
</head>
<body class="text-gray-800">
    
    <canvas id="background-canvas" class="fixed top-0 left-0 w-full h-full z-0"></canvas>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl relative z-10">
        <header class="text-center mb-10 animate-fade-in">
            <div class="logo-container inline-block rounded-2xl shadow-md mb-4 overflow-hidden">
                <svg class="h-28 w-auto" viewBox="0 0 1600 900" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <clipPath id="moving-circle-mask">
                            <circle id="mask-circle-animate" cy="450" r="160" />
                        </clipPath>
                        <style>
                            .hirely-text-logo {
                                font-family: 'Inter', sans-serif;
                                font-size: 320px;
                                font-weight: 800;
                                text-anchor: middle;
                                dominant-baseline: central;
                            }
                             .hirely-letter-span {
                                transition: transform 0.1s linear;
                                display: inline-block;
                                transform-origin: center;
                            }
                        </style>
                    </defs>
                
                    <rect width="100%" height="100%" fill="#f7f18e" />
                    <text id="base-text" class="hirely-text-logo" x="50%" y="50%" fill="#000000">
                        <tspan class="hirely-letter-span">H</tspan><tspan class="hirely-letter-span">i</tspan><tspan class="hirely-letter-span">r</tspan><tspan class="hirely-letter-span">e</tspan><tspan class="hirely-letter-span">l</tspan><tspan class="hirely-letter-span">y</tspan>
                    </text>
                
                    <g clip-path="url(#moving-circle-mask)">
                        <rect width="100%" height="100%" fill="#000000" />
                        <text id="masked-text" class="hirely-text-logo" x="50%" y="50%" fill="#f7f18e">
                             <tspan class="hirely-letter-span">H</tspan><tspan class="hirely-letter-span">i</tspan><tspan class="hirely-letter-span">r</tspan><tspan class="hirely-letter-span">e</tspan><tspan class="hirely-letter-span">l</tspan><tspan class="hirely-letter-span">y</tspan>
                        </text>
                    </g>
                </svg>
            </div>
            <h1 class="text-5xl font-extrabold text-gray-900">Smart Resume Ranker</h1>
             <div class="mt-4 flex justify-center">
                <button id="careerPortalBtn" class="bg-white/80 text-indigo-600 font-semibold py-2 px-5 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v1.126a9.002 9.002 0 015.658 2.388l.8-.8a1 1 0 011.414 1.414l-.8.8A8.963 8.963 0 0120 10a1 1 0 11-2 0 7 7 0 10-10.43 5.912l.182.182a1 1 0 01-1.414 1.414l-3.536-3.536a1 1 0 010-1.414l3.536-3.536a1 1 0 011.414 1.414l-.182.182A7.002 7.002 0 0011 18V5.5a1 1 0 01.5-.866l4-2.5a1 1 0 011 1.732l-4 2.5a1 1 0 01-1.5-.866V2a1 1 0 01.3-.754zM4.342 5.658A1 1 0 015.757 4.243l.8.8A8.963 8.963 0 0110 4a1 1 0 110 2 7 7 0 00-5.912 10.43l-.182-.182a1 1 0 01-1.414-1.414l3.536 3.536a1 1 0 010 1.414l-3.536 3.536a1 1 0 11-1.414-1.414l.182-.182A7.002 7.002 0 014 5.5V16a1 1 0 11-2 0V5.5a1 1 0 01.866-1.5l2.5-4a1 1 0 111.732 1l-2.5 4a1 1 0 01-.866.5z" clip-rule="evenodd" />
                    </svg>
                    Career Time Machine
                </button>
            </div>
            <div class="h-8 mt-3"><p id="tagline" class="text-xl text-gray-600"></p></div>
        </header>

        <main class="glass-card p-6 md:p-8 rounded-3xl shadow-lg">
            
            <button id="settingsBtn" class="absolute top-4 right-4 text-gray-500 hover:text-indigo-600 hover:rotate-90 transition-all duration-300 p-2 rounded-full hover:bg-white/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>

            <div id="mainContent">
                <div class="grid md:grid-cols-2 gap-8 mb-6">
                    <div class="animate-fade-in delay-2 opacity-0">
                        <h2 class="text-2xl font-bold mb-3 text-gray-800 flex items-center"><span class="text-indigo-500 mr-3">1</span> Add Job Description</h2>
                        <textarea id="jobDescriptionTextarea" rows="10" class="w-full p-4 bg-white bg-opacity-80 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition shadow-sm" placeholder="Paste the job description here..."></textarea>
                        <div class="text-center mt-3">
                            <input type="file" id="jobDescriptionUpload" class="hidden" accept=".pdf,.docx">
                            <label for="jobDescriptionUpload" class="text-indigo-600 hover:underline cursor-pointer font-medium text-sm">... or upload a file</label>
                        </div>
                        <div id="jdError" class="mt-2 text-center text-red-600 font-medium"></div>
                    </div>

                    <div class="animate-fade-in delay-3 opacity-0">
                        <h2 class="text-2xl font-bold mb-3 text-gray-800 flex items-center"><span class="text-indigo-500 mr-3">2</span> Upload Resumes</h2>
                        <div id="dropzone" class="dropzone border-2 border-dashed border-gray-400 rounded-xl p-6 text-center h-full flex flex-col justify-center bg-white bg-opacity-50 hover:border-indigo-500">
                            <input type="file" id="resumeUpload" class="hidden" accept=".pdf,.docx" multiple>
                            <label for="resumeUpload" class="cursor-pointer">
                                <div id="uploadPrompt">
                                    <svg class="mx-auto h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                                    <p class="mt-2 text-sm text-gray-600"><span class="font-semibold text-indigo-600">Click to upload</span> or drag & drop</p>
                                    <p class="text-xs text-gray-500 mt-1">PDF or DOCX files</p>
                                </div>
                            </label>
                            <div id="resumeFileNames" class="mt-4 flex flex-wrap justify-center gap-2"></div>
                            <div id="removeResumesContainer" class="hidden text-center mt-4">
                                <button id="removeResumesBtn" class="text-sm text-red-600 hover:underline font-medium">Remove All</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-12 animate-fade-in delay-4 opacity-0">
                    <button id="rankButton" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 px-10 rounded-lg text-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed disabled:scale-100 disabled:shadow-none">
                        Rank Resumes
                    </button>
                </div>
            </div>

            <div id="resultsSection" class="mt-12">
                <div id="status" class="text-center hidden p-8">
                    <div class="loader mx-auto"></div>
                    <p id="statusText" class="mt-6 text-lg font-semibold text-gray-700">Analyzing resumes...</p>
                </div>
                <div id="rankedSummaryContainer" class="hidden mb-8"></div>
                
                <div id="chartsContainer" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="lg:col-span-1 p-6 bg-white/80 rounded-2xl shadow-lg chart-container"><canvas id="resultsChart"></canvas></div>
                    <div class="lg:col-span-1 p-6 bg-white/80 rounded-2xl shadow-lg chart-container"><canvas id="distributionChart"></canvas></div>
                </div>
                <div id="cardResultsContainer" class="space-y-6"></div>
            </div>
        </main>
    </div>

    <div id="apiKeyModal" class="modal-overlay">
        <div class="modal-content relative">
            <button id="closeApiModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <h2 class="text-2xl font-bold mb-3 text-gray-800 flex items-center">Local AI Settings</h2>
            <p class="text-sm text-gray-600 mb-4">This app is running on a local AI model via Ollama. No API key is needed.</p>
            <div class="space-y-4">
                <input type="text" id="apiKeyInput" placeholder="No API Key Required" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg" disabled>
            </div>
            <button id="saveApiKeys" class="mt-6 w-full px-5 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-all duration-300 shadow-md">Close</button>
        </div>
    </div>

    <div id="questionsModal" class="modal-overlay">
        <div class="modal-content relative">
            <button id="closeQuestionsModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">✨ AI-Generated Interview Questions</h2>
            <div id="questionsContent"></div>
            <div class="text-right mt-6"><button id="copyQuestionsBtn" class="bg-indigo-100 text-indigo-700 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-indigo-200 transition-colors duration-300 transform hover:-translate-y-0.5">Copy Questions</button></div>
        </div>
    </div>
    
    <div id="careerPortalModal" class="modal-overlay">
        <div class="modal-content relative !w-11/12 !max-w-4xl !p-4 h-5/6">
            <button id="closeCareerPortalBtn" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 bg-white/50 rounded-full p-1 z-20"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            <iframe src="https://careertimemachine.created.app/" class="w-full h-full border-0 rounded-lg"></iframe>
        </div>
    </div>


    <div id="toast"></div>

    <script>
        const CONFIG = {
            API_URL: "http://localhost:11434/v1/chat/completions",
            MODEL: "llama3",
        };

        const settingsBtn = document.getElementById('settingsBtn');
        const apiKeyModal = document.getElementById('apiKeyModal');
        const closeApiModalBtn = document.getElementById('closeApiModalBtn');
        const saveApiKeys = document.getElementById('saveApiKeys');
        const mainContent = document.getElementById('mainContent');
        const jdTextarea = document.getElementById('jobDescriptionTextarea');
        const jdUpload = document.getElementById('jobDescriptionUpload');
        const jdError = document.getElementById('jdError');
        const dropzone = document.getElementById('dropzone');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const resumeUpload = document.getElementById('resumeUpload');
        const resumeFileNames = document.getElementById('resumeFileNames');
        const rankButton = document.getElementById('rankButton');
        const resultsSection = document.getElementById('resultsSection');
        const statusDiv = document.getElementById('status');
        const statusText = document.getElementById('statusText');
        const rankedSummaryContainer = document.getElementById('rankedSummaryContainer');
        const chartsContainer = document.getElementById('chartsContainer');
        const cardResultsContainer = document.getElementById('cardResultsContainer');
        const questionsModal = document.getElementById('questionsModal');
        const closeQuestionsModalBtn = document.getElementById('closeQuestionsModalBtn');
        const questionsContent = document.getElementById('questionsContent');
        const copyQuestionsBtn = document.getElementById('copyQuestionsBtn');
        const taglineEl = document.getElementById('tagline');
        const toastEl = document.getElementById('toast');
        const careerPortalBtn = document.getElementById('careerPortalBtn');
        const careerPortalModal = document.getElementById('careerPortalModal');
        const closeCareerPortalBtn = document.getElementById('closeCareerPortalBtn');
        const removeResumesBtn = document.getElementById('removeResumesBtn');
        const removeResumesContainer = document.getElementById('removeResumesContainer');

        let jobDescriptionText = '';
        let resumeFilesData = new Map();
        let barChartInstance, pieChartInstance = null;
        let globalValidResults = [];
        const taglines = [ "Leverage AI to find the perfect candidate, faster.", "From chaos to clarity in your hiring process.", "Unlock the potential in every resume.", "Data-driven decisions, better hires.", "Hiring, intelligently automated.", "Discover top talent in minutes, not weeks.", "Your AI-powered recruiting co-pilot." ];
        let taglineIndex = 0;
        let toastTimeout;

        document.addEventListener('DOMContentLoaded', () => {
            pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
            
            taglineEl.textContent = taglines[taglineIndex];
            setInterval(() => {
                taglineIndex = (taglineIndex + 1) % taglines.length;
                taglineEl.textContent = taglines[taglineIndex];
            }, 7000);

            initBackgroundAnimation();
            initLogoZoomAnimation();
            setupEventListeners();
            checkRankButtonState();
        });
        
        function initLogoZoomAnimation() {
            const circle = document.getElementById('mask-circle-animate');
            const baseTextSpans = document.querySelectorAll("#base-text .hirely-letter-span");
            const maskedTextSpans = document.querySelectorAll("#masked-text .hirely-letter-span");

            if (!circle || baseTextSpans.length === 0 || maskedTextSpans.length === 0) {
                return;
            }

            function updateZoom() {
                const circleRect = circle.getBoundingClientRect();
                const circleCenterX = circleRect.left + circleRect.width / 2;

                baseTextSpans.forEach((span, index) => {
                    const letterRect = span.getBoundingClientRect();
                    const maskedSpan = maskedTextSpans[index];

                    if (circleCenterX >= letterRect.left && circleCenterX <= letterRect.right) {
                        span.style.transform = 'scale(1.2)';
                        maskedSpan.style.transform = 'scale(1.2)';
                    } else {
                        span.style.transform = 'scale(1)';
                        maskedSpan.style.transform = 'scale(1)';
                    }
                });

                requestAnimationFrame(updateZoom);
            }
            requestAnimationFrame(updateZoom);
        }

        function setupEventListeners() {
            settingsBtn.addEventListener('click', () => apiKeyModal.classList.add('active'));
            closeApiModalBtn.addEventListener('click', () => apiKeyModal.classList.remove('active'));
            apiKeyModal.addEventListener('click', (e) => {
                if (e.target === apiKeyModal) apiKeyModal.classList.remove('active');
            });
            
            careerPortalBtn.addEventListener('click', () => careerPortalModal.classList.add('active'));
            closeCareerPortalBtn.addEventListener('click', () => careerPortalModal.classList.remove('active'));
            careerPortalModal.addEventListener('click', (e) => {
                if (e.target === careerPortalModal) careerPortalModal.classList.remove('active');
            });

            saveApiKeys.addEventListener('click', () => {
                apiKeyModal.classList.remove('active');
                showToast('Settings saved (no key needed for local AI).');
            });

            jdTextarea.addEventListener('input', () => {
                jobDescriptionText = jdTextarea.value;
                checkRankButtonState();
            });

            jdUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    jdError.textContent = '';
                    extractTextFromFile(file).then(text => {
                        jdTextarea.value = text;
                        jobDescriptionText = text;
                        checkRankButtonState();
                    }).catch(err => {
                        console.error("Error extracting text from JD:", err);
                        jdError.textContent = `Error: ${err.message}`;
                    });
                }
            });
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => dropzone.addEventListener(e, preventDefaults, false));
            ['dragenter', 'dragover'].forEach(e => dropzone.addEventListener(e, () => dropzone.classList.add('is-dragging'), false));
            ['dragleave', 'drop'].forEach(e => dropzone.addEventListener(e, () => dropzone.classList.remove('is-dragging'), false));
            dropzone.addEventListener('drop', handleDrop, false);
            resumeUpload.addEventListener('change', (event) => handleFiles(event.target.files));
            
            rankButton.addEventListener('click', handleRankingProcess);
            
            closeQuestionsModalBtn.addEventListener('click', () => questionsModal.classList.remove('active'));
            questionsModal.addEventListener('click', (e) => {
                if (e.target === questionsModal) questionsModal.classList.remove('active');
            });

            copyQuestionsBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(questionsContent.innerText).then(() => {
                    copyQuestionsBtn.textContent = 'Copied!';
                    setTimeout(() => { copyQuestionsBtn.textContent = 'Copy Questions'; }, 2000);
                });
            });

            cardResultsContainer.addEventListener('click', handleCardClick);
            removeResumesBtn.addEventListener('click', clearResumes);
        }

        function showToast(message, isError = false) {
            clearTimeout(toastTimeout);
            toastEl.textContent = message;
            toastEl.className = isError 
                ? 'bg-red-600 show' 
                : 'bg-green-600 show';
            
            toastTimeout = setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3000);
        }

        function checkRankButtonState() {
            rankButton.disabled = !(jobDescriptionText.trim() && resumeFilesData.size > 0);
        }
        
        function clearResumes() {
            resumeFilesData.clear();
            resumeFileNames.innerHTML = '';
            uploadPrompt.classList.remove('hidden');
            removeResumesContainer.classList.add('hidden');
            resumeUpload.value = '';
            checkRankButtonState();
            showToast('All resumes removed.');
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDrop(e) {
            handleFiles(e.dataTransfer.files);
        }

        function handleFiles(files) {
            const newFiles = Array.from(files);
            newFiles.forEach(file => {
                const url = URL.createObjectURL(file);
                resumeFilesData.set(file.name, { file, url });
            });
            
            if (resumeFilesData.size > 0) {
                uploadPrompt.classList.add('hidden');
                resumeFileNames.innerHTML = '';
                Array.from(resumeFilesData.keys()).forEach(name => {
                    const pill = document.createElement('div');
                    pill.className = 'file-item';
                    pill.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg><span>${name}</span>`;
                    resumeFileNames.appendChild(pill);
                });
                removeResumesContainer.classList.remove('hidden');
            } else {
                uploadPrompt.classList.remove('hidden');
                resumeFileNames.innerHTML = '';
                removeResumesContainer.classList.add('hidden');
            }
            checkRankButtonState();
        }

        async function handleRankingProcess() {
            rankButton.disabled = true;
            mainContent.classList.add('hidden');
            statusDiv.classList.remove('hidden');
            cardResultsContainer.innerHTML = '';
            chartsContainer.classList.add('hidden');
            rankedSummaryContainer.classList.add('hidden');
            rankedSummaryContainer.innerHTML = '';
            if (barChartInstance) barChartInstance.destroy();
            if (pieChartInstance) pieChartInstance.destroy();

            const processingPromises = Array.from(resumeFilesData.values()).map(async (data) => {
                try {
                    statusText.textContent = `Extracting text from ${data.file.name}...`;
                    const text = await extractTextFromFile(data.file);
                    resumeFilesData.set(data.file.name, { ...data, text });
                    return { fileName: data.file.name, text };
                } catch (error) {
                    console.error(`Failed to process ${data.file.name}:`, error);
                    displayErrorCard(data.file.name, error.message);
                    return null;
                }
            });

            const processedFiles = (await Promise.all(processingPromises)).filter(Boolean);
            const analysisPromises = processedFiles.map((resume, index) => {
                statusText.textContent = `Analyzing resume ${index + 1}/${processedFiles.length}: ${resume.fileName}...`;
                return analyzeResumeWithAI(resume.text, jobDescriptionText)
                    .then(analysis => {
                        const breakdown = analysis.scoreBreakdown || { experience: 50, skills: 50, education: 50 };
                        const weightedScore = (breakdown.experience * 0.5) + (breakdown.skills * 0.4) + (breakdown.education * 0.1);
                        return { ...analysis, score: Math.round(weightedScore), resumeText: resume.text, fileName: resume.fileName };
                    })
                    .catch(error => ({ fileName: resume.fileName, error: `AI analysis failed: ${error.message}` }));
            });

            const results = await Promise.all(analysisPromises);
            globalValidResults = results.filter(r => !r.error);
            const errorResults = results.filter(r => r.error);
            
            globalValidResults.sort((a, b) => b.score - a.score);

            statusDiv.classList.add('hidden');
            mainContent.classList.remove('hidden');
            rankButton.disabled = false;

            if (globalValidResults.length > 0) {
                renderRankedSummary(globalValidResults);
                renderResultsChart(globalValidResults);
                renderScoreDistributionChart(globalValidResults);
            }

            globalValidResults.forEach((result, index) => {
                setTimeout(() => { displayResultCard(result, index + 1); }, index * 150);
            });
            errorResults.forEach(result => displayErrorCard(result.fileName, result.error));
        }
        
        async function handleCardClick(e) {
            const questionsBtn = e.target.closest('.generate-questions-btn');
            const resumeBtn = e.target.closest('.view-resume-btn');
            const cardHeader = e.target.closest('.expandable-card-header');

            if (questionsBtn) {
                const fileName = questionsBtn.dataset.fileName;
                const result = globalValidResults.find(r => r.fileName === fileName);
                if (!result?.resumeText) { showToast('Could not find resume text.', true); return; }
                
                questionsModal.classList.add('active');
                questionsContent.innerHTML = `<div class="loader mx-auto"></div><p class="text-center mt-4">Generating questions...</p>`;

                try {
                    const questions = await generateInterviewQuestions(result.resumeText, jobDescriptionText);
                    displayGeneratedQuestions(questions);
                } catch (error) {
                    questionsContent.innerHTML = `<p class="text-red-500">Failed to generate questions: ${error.message}</p>`;
                }
            } else if (resumeBtn) {
                const fileName = resumeBtn.dataset.fileName;
                const data = resumeFilesData.get(fileName);
                if (data && data.url) {
                    window.open(data.url, '_blank');
                } else {
                    showToast('Could not find the file to open.', true);
                }
            } else if (cardHeader) {
                const card = cardHeader.closest('.result-card');
                const detailsContent = card.querySelector('.details-content');
                const chevronIcon = card.querySelector('.chevron-icon');
                const fileName = card.dataset.fileName;
                const isExpanded = detailsContent.classList.toggle('expanded');
                chevronIcon.classList.toggle('rotate-180', isExpanded);

                if (isExpanded && detailsContent.dataset.loaded !== 'true') {
                    detailsContent.innerHTML = `<div class="flex justify-center items-center p-4"><div class="loader !w-8 !h-8"></div><span class="ml-4 text-gray-600">Fetching details...</span></div>`;
                    const result = globalValidResults.find(r => r.fileName === fileName);
                    if (result?.resumeText) {
                        try {
                            const nameToUse = result.candidateName || result.fileName.replace(/\.(pdf|docx)$/, '');
                            const details = await getDetailedAnalysis(result.resumeText, nameToUse);
                            displayDetailedAnalysis(detailsContent, details, nameToUse);
                            detailsContent.dataset.loaded = 'true';
                        } catch (error) {
                            detailsContent.innerHTML = `<p class="text-red-500 text-center p-4">Failed to fetch details: ${error.message}</p>`;
                        }
                    }
                }
            }
        }

        async function extractTextFromFile(file) {
            const fileName = file.name.toLowerCase();
            if (fileName.endsWith('.pdf')) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let textContent = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const text = await page.getTextContent();
                    textContent += text.items.map(item => item.str).join(' ') + '\n';
                }
                return textContent;
            } else if (fileName.endsWith('.docx')) {
                return new Promise((resolve, reject) => {
                    if (typeof JSZip === 'undefined') return reject(new Error("DOCX library not loaded."));
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        JSZip.loadAsync(event.target.result)
                            .then(zip => {
                                const docFile = zip.file("word/document.xml");
                                if (!docFile) reject(new Error("Invalid .docx file format."));
                                return docFile.async("string");
                            })
                            .then(content => {
                                const textContent = content.replace(/<[^>]+>/g, ' ').replace(/\s+/g, ' ').trim();
                                resolve(textContent);
                            })
                            .catch(err => reject(new Error("Could not parse .docx file.")));
                    };
                    reader.onerror = () => reject(new Error("Failed to read file."));
                    reader.readAsArrayBuffer(file);
                });
            } else {
                throw new Error('Unsupported file type. Please use PDF or DOCX.');
            }
        }

        async function callLocalApi(prompt, temperature = 0) {
            const response = await fetch(CONFIG.API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    model: CONFIG.MODEL, 
                    messages: [{ role: "user", content: prompt }],
                    temperature: temperature, 
                    response_format: { type: "json_object" }
                })
            });
            if (!response.ok) {
                const errorBody = await response.json().catch(() => ({ message: response.statusText }));
                throw new Error(`Local API Error: ${errorBody.error?.message || response.statusText}`);
            }
            const data = await response.json();
            if (!data.choices || !data.choices[0].message.content) {
                 throw new Error("Invalid response structure from local API.");
            }
            const rawContent = data.choices[0].message.content;
            const jsonMatch = rawContent.match(/\{[\s\S]*\}|\[[\s\S]*\]/);
            if (!jsonMatch) {
                throw new Error("No valid JSON found in the AI response.");
            }
            return JSON.parse(jsonMatch[0]);
        }

        async function analyzeResumeWithAI(resumeText, jdText) {
            const prompt = `You are an expert HR analyst. Analyze the provided resume against the job description.
            **Job Description:**\n${jdText}\n\n**Resume:**\n${resumeText}\n\n
            **Instructions:**
            1.  **Candidate Name:** Extract the full name precisely as it appears. Then, format it in Title Case (e.g., "JOHN DOE" becomes "John Doe", "sharanabasavesha. s. erimani" becomes "Sharanabasavesha S. Erimani"). Be extremely careful to preserve all parts of the name, including initials.
            2.  **Score Breakdown:** Provide a score from 0-100 for each of the following categories based on the job description: "experience", "skills", and "education".
            3.  **Strengths & Weaknesses:** List exactly 3 key strengths and 2 key weaknesses.
            4.  **Summary:** Write a concise, 2-sentence summary.
            **Output Format:** Respond ONLY with a valid JSON object: {"candidateName": "<string>", "scoreBreakdown": {"experience": <number>, "skills": <number>, "education": <number>}, "strengths": ["<string>"], "weaknesses": ["<string>"], "summary": "<string>"}`;
            return callLocalApi(prompt);
        }

        async function generateInterviewQuestions(resumeText, jdText) {
            const prompt = `As an expert hiring manager, create interview questions based on a resume and job description. **Job Description:**\n${jdText}\n\n**Candidate's Resume:**\n${resumeText}\n\n**Instructions:** Generate 3 behavioral, 3 technical, and 2 situational questions. Focus on the specific projects, roles, and skills listed in the candidate's resume. Create questions that probe their unique experience, not generic questions that could apply to anyone. **Output Format:** Respond ONLY with a valid JSON object: {"behavioral": ["<question>"], "technical": ["<question>"], "situational": ["<question>"]}`;
            return callLocalApi(prompt, 0.6);
        }

        async function getDetailedAnalysis(resumeText, candidateName) {
            const prompt = `You are analyzing the resume for a candidate named "${candidateName}". Analyze the resume and extract structured information. **Resume Text:**\n${resumeText}\n\n**Instructions:** Extract: 1. **detailedSummary:** A comprehensive paragraph. 2. **skills:** An array of key skills. 3. **experience:** An array of objects with "role", "company", "duration". 4. **education:** An array of objects with "degree", "institution", "year". If not found, return empty values. **Output Format:** Respond ONLY with a valid JSON object: {"detailedSummary": "<string>", "skills": ["<string>"], "experience": [...], "education": [...]}`;
            return callLocalApi(prompt);
        }
        
        function renderRankedSummary(results) {
            rankedSummaryContainer.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Ranking Summary</h2>
                <div class="bg-white/80 p-4 rounded-xl shadow-md">
                    <ol class="space-y-2">
                        ${results.map((result, index) => `
                            <li class="flex justify-between items-center p-2 rounded-md ${index % 2 === 0 ? 'bg-indigo-50' : ''}" data-file-name="${result.fileName}">
                                <span class="font-semibold text-gray-700">
                                    ${index + 1}. <strong class="text-indigo-800">${result.candidateName || result.fileName.replace(/\.(pdf|docx)$/, '')}</strong>
                                </span>
                                <span class="font-bold text-lg ${result.score >= 80 ? 'text-green-600' : result.score >= 60 ? 'text-orange-500' : 'text-red-500'}">
                                    ${result.score}
                                </span>
                            </li>
                        `).join('')}
                    </ol>
                </div>
            `;
            rankedSummaryContainer.classList.remove('hidden');
            rankedSummaryContainer.classList.add('animate-fade-in');
        }

        function displayGeneratedQuestions(questions) {
            let html = '<div class="space-y-6">';
            if (questions.behavioral?.length) {
                html += `<div><h3 class="text-lg font-semibold text-indigo-700 mb-2">Behavioral</h3><ul class="list-disc list-inside space-y-2 text-gray-700">${questions.behavioral.map(q => `<li>${q}</li>`).join('')}</ul></div>`;
            }
            if (questions.technical?.length) {
                html += `<div><h3 class="text-lg font-semibold text-indigo-700 mb-2">Technical</h3><ul class="list-disc list-inside space-y-2 text-gray-700">${questions.technical.map(q => `<li>${q}</li>`).join('')}</ul></div>`;
            }
            if (questions.situational?.length) {
                html += `<div><h3 class="text-lg font-semibold text-indigo-700 mb-2">Situational</h3><ul class="list-disc list-inside space-y-2 text-gray-700">${questions.situational.map(q => `<li>${q}</li>`).join('')}</ul></div>`;
            }
            html += '</div>';
            questionsContent.innerHTML = html;
        }

        function renderResultsChart(results) {
            chartsContainer.classList.remove('hidden');
            const ctx = document.getElementById('resultsChart').getContext('2d');
            const labels = results.map(r => r.candidateName || r.fileName.replace(/\.(pdf|docx)$/, ''));
            const scores = results.map(r => r.score);
            const backgroundColors = scores.map(s => s >= 80 ? 'rgba(52, 211, 153, 0.7)' : s >= 60 ? 'rgba(251, 146, 60, 0.7)' : 'rgba(239, 68, 68, 0.7)');
            const borderColors = scores.map(s => s >= 80 ? 'rgba(16, 185, 129, 1)' : s >= 60 ? 'rgba(249, 115, 22, 1)' : 'rgba(220, 38, 38, 1)');
            barChartInstance = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ label: 'Candidate Match Score', data: scores, backgroundColor: backgroundColors, borderColor: borderColors, borderWidth: 2, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, max: 100, grid: { color: 'rgba(0,0,0,0.05)' } }, y: { grid: { display: false } } }, plugins: { legend: { display: false }, title: { display: true, text: 'Candidate Score Comparison', font: { size: 18, weight: 'bold' }, padding: { bottom: 20 } } }, animation: { delay: (c) => c.dataIndex * 100 } } });
        }

        function renderScoreDistributionChart(results) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            const topTier = results.filter(r => r.score >= 80).length;
            const promising = results.filter(r => r.score >= 60 && r.score < 80).length;
            const needsReview = results.filter(r => r.score < 60).length;
            pieChartInstance = new Chart(ctx, { type: 'doughnut', data: { labels: ['Top Tier (80+)', 'Promising (60-79)', 'Needs Review (<60)'], datasets: [{ data: [topTier, promising, needsReview], backgroundColor: ['rgba(52, 211, 153, 0.7)', 'rgba(251, 146, 60, 0.7)', 'rgba(239, 68, 68, 0.7)'], borderColor: ['#10b981', '#f97316', '#dc2626'], borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Candidate Distribution', font: { size: 18, weight: 'bold' }, padding: { bottom: 20 } } }, animation: { animateScale: true, animateRotate: true } } });
        }
        
        function displayResultCard(result, rank) {
            const score = parseInt(result.score) || 0;
            const scoreColor = score >= 80 ? 'text-green-600' : score >= 60 ? 'text-orange-500' : 'text-red-500';
            const rankColor = rank === 1 ? 'bg-amber-400' : rank === 2 ? 'bg-slate-300' : rank === 3 ? 'bg-amber-600' : 'bg-slate-200';
            const radius = 54;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (score / 100) * circumference;
            const card = document.createElement('div');
            card.className = "result-card bg-white/80 backdrop-blur-sm border border-gray-200 rounded-2xl p-6 shadow-lg opacity-0 animate-fade-in";
            card.dataset.fileName = result.fileName;
            card.innerHTML = `<div class="expandable-card-header flex flex-col md:flex-row items-center gap-6 relative"><div class="absolute -top-10 -left-4 ${rankColor} text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transform -rotate-6">Rank #${rank}</div><div class="flex-shrink-0 relative"><svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120"><circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="${radius}" cx="60" cy="60" /><circle class="${scoreColor}" stroke-width="8" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round" stroke="currentColor" fill="transparent" r="${radius}" cx="60" cy="60" style="transition: stroke-dashoffset 0.8s ease-out;" /></svg><div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-3xl font-bold ${scoreColor}">${score}</span><span class="text-sm text-gray-500">Match</span></div></div><div class="flex-grow w-full"><div class="flex justify-between items-start mb-2"><h3 class="text-xl font-bold text-gray-800 pr-8">${result.candidateName || result.fileName.replace(/\.(pdf|docx)$/, '')}</h3><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 chevron-icon flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg></div><p class="text-gray-600 mb-4 text-sm italic">"${result.summary}"</p> <div class="text-xs text-gray-500 grid grid-cols-3 gap-2 mb-4 text-center"><div><span class="font-bold text-gray-700">Experience</span><div class="text-lg font-semibold text-indigo-600">${result.scoreBreakdown?.experience || 'N/A'}</div></div><div><span class="font-bold text-gray-700">Skills</span><div class="text-lg font-semibold text-indigo-600">${result.scoreBreakdown?.skills || 'N/A'}</div></div><div><span class="font-bold text-gray-700">Education</span><div class="text-lg font-semibold text-indigo-600">${result.scoreBreakdown?.education || 'N/A'}</div></div></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm strength-weakness"><div><h4 class="font-semibold text-green-700 mb-2 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>Strengths</h4><ul class="list-inside space-y-1 text-gray-600">${result.strengths.map(s => `<li>${s}</li>`).join('')}</ul></div><div><h4 class="font-semibold text-red-700 mb-2 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>Weaknesses</h4><ul class="list-inside space-y-1 text-gray-600">${result.weaknesses.map(w => `<li>${w}</li>`).join('')}</ul></div></div><div class="mt-4 flex justify-end space-x-2"><button class="view-resume-btn interactive-btn bg-gray-100 text-gray-700 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-200" data-file-name="${result.fileName}">View Resume</button><button class="generate-questions-btn interactive-btn bg-indigo-100 text-indigo-700 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-indigo-200" data-file-name="${result.fileName}">✨ Gen. Questions</button></div></div></div><div class="details-content" data-loaded="false"></div>`;
            cardResultsContainer.appendChild(card);
        }
        
        function displayDetailedAnalysis(container, details, candidateName) {
            let html = '<div class="p-4 space-y-4 text-sm">';
            html += `<div><h4 class="font-bold text-gray-700 mb-1">Detailed Summary for ${candidateName}</h4><p class="text-gray-600">${details.detailedSummary || 'Not available.'}</p></div>`;
            if (details.skills?.length) html += `<div><h4 class="font-bold text-gray-700 mb-2">Key Skills</h4><div class="flex flex-wrap gap-2">${details.skills.map(s => `<span class="skill-pill bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${s}</span>`).join('')}</div></div>`;
            if (details.experience?.length) html += `<div><h4 class="font-bold text-gray-700 mb-2">Work Experience</h4><ul class="space-y-2 border-l-2 border-indigo-200 pl-4">${details.experience.map(e => `<li><p class="font-semibold">${e.role} at ${e.company}</p><p class="text-gray-500 text-xs">${e.duration||''}</p></li>`).join('')}</ul></div>`;
            if (details.education?.length) html += `<div><h4 class="font-bold text-gray-700 mb-2">Education</h4><ul class="space-y-1">${details.education.map(e => `<li><p class="font-semibold">${e.degree} - ${e.institution}</p><p class="text-gray-500 text-xs">${e.year||''}</p></li>`).join('')}</ul></div>`;
            html += '</div>';
            container.innerHTML = html;
        }

        function displayErrorCard(fileName, errorMessage) {
            const card = document.createElement('div');
            card.className = "bg-red-50 border border-red-200 rounded-xl p-6 opacity-0 animate-fade-in";
            card.innerHTML = `<div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500 mr-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg><div><h3 class="text-lg font-bold text-red-800">${fileName}</h3><p class="text-red-700 mt-1"><strong>Error:</strong> ${errorMessage}</p></div></div>`;
            cardResultsContainer.appendChild(card);
        }

        function initBackgroundAnimation() {
            const canvas = document.getElementById('background-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let particlesArray;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            class Particle { constructor(x,y,dirX,dirY,size) { this.x=x;this.y=y;this.directionX=dirX;this.directionY=dirY;this.size=size; } draw() { ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2,false); ctx.fillStyle='rgba(79,70,229,0.4)'; ctx.fill(); } update() { if(this.x>canvas.width||this.x<0)this.directionX=-this.directionX; if(this.y>canvas.height||this.y<0)this.directionY=-this.directionY; this.x+=this.directionX; this.y+=this.directionY; this.draw(); } }
            function init() { particlesArray=[]; let num = (canvas.height*canvas.width)/12000; for(let i=0;i<num;i++) { let size=(Math.random()*2)+1; let x=(Math.random()*((innerWidth-size*2)-(size*2))+size*2); let y=(Math.random()*((innerHeight-size*2)-(size*2))+size*2); let dirX=(Math.random()*0.4)-0.2; let dirY=(Math.random()*0.4)-0.2; particlesArray.push(new Particle(x,y,dirX,dirY,size)); } }
            function animate() { requestAnimationFrame(animate); ctx.clearRect(0,0,innerWidth,innerHeight); for(let i=0;i<particlesArray.length;i++) particlesArray[i].update(); connect(); }
            function connect() { let opacity=1; for(let a=0;a<particlesArray.length;a++) { for(let b=a;b<particlesArray.length;b++) { let dist=((particlesArray[a].x-particlesArray[b].x)*(particlesArray[a].x-particlesArray[b].x))+((particlesArray[a].y-particlesArray[b].y)*(particlesArray[a].y-particlesArray[b].y)); if(dist<(canvas.width/8)*(canvas.height/8)) { opacity=1-(dist/20000); ctx.strokeStyle=`rgba(79,70,229,${opacity})`; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(particlesArray[a].x,particlesArray[a].y); ctx.lineTo(particlesArray[b].x,particlesArray[b].y); ctx.stroke(); } } } }
            window.addEventListener('resize', () => { canvas.width=innerWidth; canvas.height=innerHeight; init(); });
            init(); animate();
        }
    </script>
</body>
</html>